name: dlt
prefect-version: 3.4.22

pull:
- prefect.deployments.steps.git_clone:
    id: clone-step
    repository: https://github.com/h-wb/pipelines.git
    branch: main
- prefect.deployments.steps.run_shell_script:
    directory: '{{ clone-step.directory }}'
    script: uv pip install .

deployments:
- name: load_listenbrainz
  version: null
  tags: []
  description: null
  schedule:
    cron: '0 0 * * *'
  flow_name: load_listenbrainz
  entrypoint: src/pipelines/listenbrainz.py:load_listenbrainz
  parameters: {}
  work_pool:
    name: local-pool
    work_queue_name: default
    job_variables: 
      env:
        LISTENBRAINZ__USERNAME: "{{ $LISTENBRAINZ__USERNAME }}"
        LISTENBRAINZ__ACCESS_TOKEN: "{{ $LISTENBRAINZ__ACCESS_TOKEN }}"
        LISTENBRAINZ__START_DATE: "{{ $LISTENBRAINZ__START_DATE }}"
        DESTINATION__DUCKDB__DESTINATION_NAME: "{{ $DESTINATION__DUCKDB__DESTINATION_NAME }}"
        RUNTIME__LOG_LEVEL: 'DEBUG'