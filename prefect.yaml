name: dlt
prefect-version: 3.4.22
definitions:
  work_pools:
    default_work_pool: &default_work_pool
      name: local-pool
      work_queue_name: default
  base_env: &base_env
    RUNTIME__LOG_LEVEL: "{{ $RUNTIME__LOG_LEVEL }}"
    PREFECT_LOGGING_EXTRA_LOGGERS: "{{ $PREFECT_LOGGING_EXTRA_LOGGERS }}"
    PREFECT_LOGGING_LOG_PRINTS: "{{ $PREFECT_LOGGING_LOG_PRINTS }}"

pull:
- prefect.deployments.steps.git_clone:
    id: clone-step
    repository: https://github.com/h-wb/pipelines.git
    branch: main
- prefect.deployments.steps.run_shell_script:
    directory: '{{ clone-step.directory }}'
    script: uv pip install .

deployments:
- name: load_listenbrainz
  version: null
  tags: []
  description: null
  schedule:
    cron: '0 0 * * *'
  flow_name: load_listenbrainz
  entrypoint: src/pipelines/listenbrainz.py:load_listenbrainz
  parameters: {}
  work_pool:
    <<: *default_work_pool
    job_variables:
      env:
        <<: *base_env
        LISTENBRAINZ__USERNAME: "{{ $LISTENBRAINZ__USERNAME }}"
        LISTENBRAINZ__ACCESS_TOKEN: "{{ $LISTENBRAINZ__ACCESS_TOKEN }}"
        LISTENBRAINZ__START_DATE: "{{ $LISTENBRAINZ__START_DATE }}"
        DESTINATION__DUCKDB__DESTINATION_NAME: "{{ $DESTINATION__DUCKDB__DESTINATION_NAME }}listenbrainz"

- name: load_arc_timeline
  version: null
  tags: []
  description: null
  schedule:
    cron: '0 0 * * 0'
  flow_name: load_arc_timeline
  entrypoint: src/pipelines/arc_timeline.py:load_arc_timeline
  parameters: {}
  work_pool:
    <<: *default_work_pool
    job_variables:
      env:
        <<: *base_env
        ARC_TIMELINE__APPLE_ID: "{{ $ARC_TIMELINE__APPLE_ID }}"
        ARC_TIMELINE__PASSWORD: "{{ $ARC_TIMELINE__PASSWORD }}"
        DESTINATION__DUCKDB__DESTINATION_NAME: "{{ $DESTINATION__DUCKDB__DESTINATION_NAME }}arc_timeline"

- name: load_bikeshare
  version: null
  tags: []
  description: null
  schedule:
    cron: '0 0 * * *'
  flow_name: load_bikeshare
  entrypoint: src/pipelines/bikeshare.py:load_bikeshare
  parameters: {}
  work_pool:
    <<: *default_work_pool
    job_variables:
      env:
        <<: *base_env
        BIKESHARE__MEMBER_ID: "{{ $BIKESHARE__MEMBER_ID }}"
        BIKESHARE__AUTHORIZATION_TOKEN: "{{ $BIKESHARE__AUTHORIZATION_TOKEN }}"
        DESTINATION__DUCKDB__DESTINATION_NAME: "{{ $DESTINATION__DUCKDB__DESTINATION_NAME }}bikeshare"